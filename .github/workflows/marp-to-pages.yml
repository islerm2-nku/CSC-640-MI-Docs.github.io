name: Convert Marp to HTML for GitHub Pages

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Install Marp CLI
      run: |
        npm install -g @marp-team/marp-cli@3.4.0
        marp --version
        
    - name: Debug - List markdown files
      run: |
        echo "Current directory:"
        pwd
        echo "Markdown files:"
        find . -name "*.md" -type f
        echo "File permissions:"
        ls -la *.md
        
    - name: Convert presentations one by one
      run: |
        # Convert presentations individually with full paths
        echo "Converting index.md..."
        npx @marp-team/marp-cli@3.4.0 --html --allow-local-files "./index.md" --output "./index.html"
        
        echo "Converting requirements.md..."
        npx @marp-team/marp-cli@3.4.0 --html --allow-local-files "./requirements.md" --output "./requirements.html"
        
        echo "Converting tech-stack.md..."
        npx @marp-team/marp-cli@3.4.0 --html --allow-local-files "./tech-stack.md" --output "./tech-stack.html"
        
        echo "Converting modular-code.md..."
        npx @marp-team/marp-cli@3.4.0 --html --allow-local-files "./modular-code.md" --output "./modular-code.html"
        
        echo "Converting testing.md..."
        npx @marp-team/marp-cli@3.4.0 --html --allow-local-files "./testing.md" --output "./testing.html"
        
        echo "Converting deployment.md..."
        npx @marp-team/marp-cli@3.4.0 --html --allow-local-files "./deployment.md" --output "./deployment.html"
        
        echo "Converting additional-topics.md..."
        npx @marp-team/marp-cli@3.4.0 --html --allow-local-files "./additional-topics.md" --output "./additional-topics.html"
        
    - name: Verify HTML files created
      run: |
        echo "Generated HTML files:"
        ls -la *.html
        echo "Checking if files have content:"
        for file in *.html; do
          if [ -f "$file" ]; then
            echo "$file: $(wc -l < "$file") lines"
          fi
        done
        
    - name: Create navigation page
      run: |
        # Create a simple navigation index as nav.html
        cat > nav.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <head>
            <title>Software Quality Documentation</title>
            <style>
                body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
                h1 { color: #333; }
                .presentations { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
                .card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; text-decoration: none; color: inherit; }
                .card:hover { background: #f5f5f5; }
                .card h3 { margin-top: 0; color: #667eea; }
            </style>
        </head>
        <body>
            <h1>Software Quality Documentation</h1>
            <p>Interactive Marp presentations covering essential software quality principles.</p>
            
            <div class="presentations">
                <a href="index.html" class="card">
                    <h3>üìä Complete Overview</h3>
                    <p>All software quality principles in one comprehensive presentation</p>
                </a>
                
                <a href="requirements.html" class="card">
                    <h3>üìã Requirements & Goals</h3>
                    <p>Well-defined stories and clear goals as the foundation of quality</p>
                </a>
                
                <a href="tech-stack.html" class="card">
                    <h3>üõ†Ô∏è Tech Stack Selection</h3>
                    <p>Choosing the right technologies for long-term success</p>
                </a>
                
                <a href="modular-code.html" class="card">
                    <h3>üß© Modular Code Design</h3>
                    <p>Building reusable, maintainable components with SOLID principles</p>
                </a>
                
                <a href="testing.html" class="card">
                    <h3>üß™ Test Coverage</h3>
                    <p>Comprehensive testing strategies and best practices</p>
                </a>
                
                <a href="deployment.html" class="card">
                    <h3>üöÄ Deploy Early & Often</h3>
                    <p>Continuous integration and deployment practices</p>
                </a>
                
                <a href="additional-topics.html" class="card">
                    <h3>‚ûï Additional Practices</h3>
                    <p>Code review, security, monitoring, and other quality practices</p>
                </a>
            </div>
            
            <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666;">
                <p>CSC-640 Software Quality Documentation | Created with Marp</p>
            </footer>
        </body>
        </html>
        EOF
        
        # Create a simple navigation index
        cat > nav.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <head>
            <title>Software Quality Documentation</title>
            <style>
                body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
                h1 { color: #333; }
                .presentations { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
                .card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; text-decoration: none; color: inherit; }
                .card:hover { background: #f5f5f5; }
                .card h3 { margin-top: 0; color: #667eea; }
            </style>
        </head>
        <body>
            <h1>Software Quality Documentation</h1>
            <p>Interactive Marp presentations covering essential software quality principles.</p>
            
            <div class="presentations">
                <a href="index.html" class="card">
                    <h3>üìä Complete Overview</h3>
                    <p>All software quality principles in one comprehensive presentation</p>
                </a>
                
                <a href="requirements.html" class="card">
                    <h3>üìã Requirements & Goals</h3>
                    <p>Well-defined stories and clear goals as the foundation of quality</p>
                </a>
                
                <a href="tech-stack.html" class="card">
                    <h3>üõ†Ô∏è Tech Stack Selection</h3>
                    <p>Choosing the right technologies for long-term success</p>
                </a>
                
                <a href="modular-code.html" class="card">
                    <h3>üß© Modular Code Design</h3>
                    <p>Building reusable, maintainable components with SOLID principles</p>
                </a>
                
                <a href="testing.html" class="card">
                    <h3>üß™ Test Coverage</h3>
                    <p>Comprehensive testing strategies and best practices</p>
                </a>
                
                <a href="deployment.html" class="card">
                    <h3>üöÄ Deploy Early & Often</h3>
                    <p>Continuous integration and deployment practices</p>
                </a>
                
                <a href="additional-topics.html" class="card">
                    <h3>‚ûï Additional Practices</h3>
                    <p>Code review, security, monitoring, and other quality practices</p>
                </a>
            </div>
            
            <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666;">
                <p>CSC-640 Software Quality Documentation | Created with Marp</p>
            </footer>
        </body>
        </html>
        EOF
        
    - name: Setup Pages
      uses: actions/configure-pages@v4
      
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: '.'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4